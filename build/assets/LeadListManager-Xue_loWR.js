import{b as e,j as t}from"./index-D4td_YMW.js";import{r as s}from"./vendor-bXYm9Nr0.js";import{x as a,t as r,y as l,z as d,T as i,F as n,G as c}from"./ui-ByK4YB5C.js";const o=({prospects:o=[],teamMembers:x=[]})=>{const[m,b]=s.useState([]),[g,h]=s.useState(new Map),[u,p]=s.useState(!1),[y,f]=s.useState(!1),[j,k]=s.useState(!1),[N,v]=s.useState(null),[w,L]=s.useState(null),[C,S]=s.useState(null),[P,z]=s.useState(!0),[I,F]=s.useState(null),[E,U]=s.useState(null),[V,D]=s.useState(!1),[M,T]=s.useState(!0),[R,q]=s.useState({name:"",description:"",selectedProspects:[]}),[A,Y]=s.useState({targetUserId:"",canView:!0,canEdit:!1});s.useEffect(()=>(T(!0),G(),()=>{T(!1)}),[]);const G=async()=>{try{z(!0),F(null);const s=await e.getLeadLists();if(!M)return;b(s);const a=new Map;for(const r of s)try{const t=await e.getLeadListPermissions(r.id);M&&a.set(r.id,t)}catch(t){a.set(r.id,[])}M&&h(a)}catch(t){M&&F("Failed to load lead lists")}finally{M&&z(!1)}};return t.jsx("div",{className:"w-full bg-gray-50 dark:bg-slate-900",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Lead Lists"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage shared lead lists and permissions"})]}),t.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition",children:[t.jsx(a,{size:20}),"New List"]})]}),I&&t.jsxs("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg flex justify-between items-center",children:[t.jsx("span",{children:I}),t.jsx("button",{onClick:()=>F(null),className:"text-red-700 dark:text-red-300 hover:font-semibold",children:"✕"})]}),E&&t.jsxs("div",{className:"mb-4 p-4 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-lg flex justify-between items-center",children:[t.jsx("span",{children:E}),t.jsx("button",{onClick:()=>U(null),className:"text-green-700 dark:text-green-300 hover:font-semibold",children:"✕"})]}),P?t.jsx("div",{className:"text-center py-12",children:"Loading..."}):0===m.length?t.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 p-8 text-center",children:[t.jsx(r,{size:48,className:"mx-auto text-gray-400 dark:text-gray-600 mb-4"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No lead lists yet"}),t.jsx("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition",children:"Create Your First List"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(s=>{const a=g.get(s.id)||[],n=o.filter(e=>s.prospectIds.includes(e.id));return t.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 p-6 hover:shadow-md transition",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:s.name}),s.description&&t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:s.description})]}),t.jsxs("div",{className:"mb-4 space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[t.jsx(r,{size:16}),t.jsxs("span",{children:[s.prospectCount," leads"]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[t.jsx(l,{size:16}),t.jsxs("span",{children:[a.length," shared with"]})]})]}),n.length>0&&t.jsxs("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg max-h-48 overflow-y-auto",children:[t.jsx("p",{className:"text-xs font-semibold text-blue-600 dark:text-blue-400 mb-2",children:"Leads in this list:"}),t.jsx("div",{className:"space-y-2",children:n.map(a=>t.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-300 flex items-center justify-between bg-white dark:bg-slate-700 p-2 rounded",children:[t.jsxs("span",{className:"truncate",children:[a.firstName," ",a.lastName,t.jsxs("span",{className:"text-gray-500 ml-1",children:["(",a.company,")"]})]}),t.jsx("button",{onClick:()=>(async(t,s)=>{if(window.confirm("Remove this lead from the list?"))try{F(null);const a=m.find(e=>e.id===t);if(!a)return;const r=a.prospectIds.filter(e=>e!==s);await e.updateLeadList(t,{prospectIds:r}),M&&(U("Lead removed from list"),b(e=>e.map(e=>e.id===t?{...e,prospectIds:r,prospectCount:r.length}:e)),setTimeout(()=>{M&&U(null)},3e3))}catch(a){M&&F("Failed to remove lead from list")}})(s.id,a.id),className:"ml-2 text-red-600 hover:text-red-700 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 px-2 py-1 rounded",title:"Remove lead from list",children:"×"})]},a.id))})]}),a.length>0&&t.jsxs("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-slate-700 rounded-lg",children:[t.jsx("p",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Shared with:"}),t.jsx("div",{className:"space-y-1",children:a.map(a=>t.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-300 flex items-center justify-between",children:[t.jsxs("span",{children:["User ",a.userId.substring(0,8),"...",t.jsx("span",{className:"ml-2 text-gray-500",children:a.canEdit?"(Edit)":a.canView?"(View)":""})]}),t.jsx("button",{onClick:()=>(async(t,s)=>{if(window.confirm("Remove this permission?"))try{await e.removeLeadListPermission(t,s),await G()}catch(a){F("Failed to remove permission")}})(s.id,a.id),className:"text-red-600 hover:text-red-700 dark:text-red-400",title:"Remove permission",children:"×"})]},a.id))})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>(e=>{v(e),f(!0)})(s),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/50 font-semibold rounded-lg transition",children:[t.jsx(d,{size:16}),"Share"]}),t.jsx("button",{onClick:()=>(async e=>{L(m.find(t=>t.id===e)||null),k(!0)})(s.id),className:"px-3 py-2 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/50 font-semibold rounded-lg transition",title:"Delete entire list",children:t.jsx(i,{size:16})})]})]},s.id)})}),u&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-slate-700",children:t.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Create New Lead List"})}),t.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),R.name.trim())try{const t=R.selectedProspects.length>0?R.selectedProspects:[];await e.createLeadList(R.name,R.description,t),q({name:"",description:"",selectedProspects:[]}),p(!1),await G()}catch(s){F("Failed to create lead list")}else F("List name is required")},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"List Name *"}),t.jsx("input",{type:"text",value:R.name,onChange:e=>q({...R,name:e.target.value}),placeholder:"e.g., Q4 Sales Prospects",className:"w-full px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),t.jsx("textarea",{value:R.description,onChange:e=>q({...R,description:e.target.value}),placeholder:"Optional description...",rows:3,className:"w-full px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Select Prospects"}),t.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-300 dark:border-slate-600 rounded-lg p-3 bg-white dark:bg-slate-700",children:0===o.length?t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No prospects available"}):t.jsx("div",{className:"space-y-2",children:o.map(e=>t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:R.selectedProspects.includes(e.id),onChange:t=>{t.target.checked?q({...R,selectedProspects:[...R.selectedProspects,e.id]}):q({...R,selectedProspects:R.selectedProspects.filter(t=>t!==e.id)})},className:"w-4 h-4 cursor-pointer"}),t.jsxs("span",{className:"text-sm text-gray-900 dark:text-gray-200",children:[e.firstName," ",e.lastName," (",e.company,")"]})]},e.id))})}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:[R.selectedProspects.length," selected"]})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700 font-semibold transition",children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition",children:"Create List"})]})]})]})}),y&&N&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-slate-700",children:t.jsxs("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:['Share "',N.name,'"']})}),t.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),N&&A.targetUserId)try{await e.addLeadListPermission(N.id,A.targetUserId,A.canView,A.canEdit),Y({targetUserId:"",canView:!0,canEdit:!1}),f(!1),await G()}catch(s){F("Failed to add permission")}else F("User selection is required")},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Select Team Member *"}),t.jsxs("select",{value:A.targetUserId,onChange:e=>Y({...A,targetUserId:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Choose a team member..."}),x.map(e=>t.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.email,")"]},e.id))]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:A.canView,onChange:e=>Y({...A,canView:e.target.checked}),className:"w-4 h-4 cursor-pointer"}),t.jsxs("span",{className:"text-sm text-gray-900 dark:text-gray-200 font-medium flex items-center gap-2",children:[t.jsx(n,{size:16}),"Can View Leads"]})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:A.canEdit,onChange:e=>Y({...A,canEdit:e.target.checked}),className:"w-4 h-4 cursor-pointer"}),t.jsxs("span",{className:"text-sm text-gray-900 dark:text-gray-200 font-medium flex items-center gap-2",children:[t.jsx(c,{size:16}),"Can Edit Leads"]})]})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700 font-semibold transition",children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition",children:"Add Permission"})]})]})]})}),j&&w&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:t.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-md w-full",children:t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 dark:bg-red-900/30 rounded-full mb-4",children:t.jsx(i,{size:24,className:"text-red-600 dark:text-red-400"})}),t.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white text-center mb-2",children:"Delete Lead List"}),t.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-center mb-4",children:["Are you sure you want to delete ",t.jsxs("span",{className:"font-semibold",children:['"',w.name,'"']}),"?"]}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-500 text-center mb-6",children:["This action cannot be undone. You have ",t.jsx("span",{className:"font-semibold",children:w.prospectCount})," leads in this list."]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:()=>k(!1),disabled:V,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700 font-semibold transition disabled:opacity-50",children:"Cancel"}),t.jsx("button",{type:"button",onClick:async()=>{if(w)try{D(!0),F(null),await e.deleteLeadList(w.id),M&&(U(`Lead list "${w.name}" deleted successfully`),k(!1),L(null),b(e=>e.filter(e=>e.id!==w.id)),h(e=>{const t=new Map(e);return t.delete(w.id),t}),setTimeout(()=>{M&&U(null)},3e3))}catch(t){M&&F("Failed to delete lead list")}finally{M&&D(!1)}},disabled:V,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition disabled:opacity-50 flex items-center justify-center gap-2",children:V?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Deleting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(i,{size:16}),"Delete List"]})})]})]})})})]})})};export{o as LeadListManager};
